<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Music Wars</title>
        <style type="text/css">
            html, body, canvas {
                margin: 0px;
                padding: 0px;
                overflow: hidden;
                background: #090B1C;
            }
            #fileUploadForm {
                position: absolute;
                top: 0px;
                left: 0px;
            }
        </style>
        <script type="text/javascript" src="./ivank-0.72.js"></script>
        <script type="text/javascript" src="./jquery-2.0.0.min.js"></script>

        <script type="text/javascript">
            $(document).ready(function() {
                var filePrompt = document.getElementById('fileUploadForm');
                filePrompt.addEventListener('change', getSongFromComputer, false);
            });
            var audioContext = new webkitAudioContext();

            function getSongFromComputer(eventObj) {
                var filename = eventObj.target.files[0];
                var reader = new FileReader();
                reader.onload = function() {
                    audioContext.decodeAudioData(reader.result, function(buffer) {
                        var audioBuffer = buffer;
                        playBuffer(audioBuffer);
                    });
                };
                reader.readAsArrayBuffer(filename);
            }

            function playBuffer(audioBuffer) {
                source = audioContext.createBufferSource();
                analyser = audioContext.createAnalyser();
                
                source.buffer = audioBuffer;
                
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                source.noteOn(0);
            }

        </script>

        <script type="text/javascript">
            var stage;
            var sp, sideWalls;


            var width = 1280;
            var height = 720;

            function Init() {
                stage = new Stage("canvas");

                sp = new Sprite();
                sideWalls = new Sprite();

                stage.addChild(sp);
                stage.addChild(sideWalls);
                stage.stageHeight = height;
                stage.stageWidth = width;

                stage.addEventListener(Event.ENTER_FRAME, Draw);
            }

            var Draw = function() {

                //	rectangles
                for(var i=0; i<0; i++)
                {
                    var color = Math.floor(Math.random()*0xffffff);
                    sp.graphics.beginFill(color, 0.6);
                    sp.graphics.drawRect(Math.random()*800, Math.random()*500, 70, 70);
                }

                //	line
                sideWalls.graphics.clear();
                var intensity = Math.random() * 36;
                sideWalls.graphics.lineStyle(intensity, 0xffffff, .50);
                intensity /= 2;
                sideWalls.graphics.moveTo(0, intensity);
                sideWalls.graphics.lineTo(width, intensity);
                sideWalls.graphics.moveTo(width - intensity, intensity * 2);
                sideWalls.graphics.lineTo(width - intensity, height);
                sideWalls.graphics.moveTo(width - intensity * 2, height - intensity);
                sideWalls.graphics.lineTo(intensity * 2, height - intensity);
                sideWalls.graphics.moveTo(intensity, height);
                sideWalls.graphics.lineTo(intensity, intensity * 2);


                sp.graphics.clear();
                sp.graphics.lineStyle(2, 0xffffff);
                var startX = 0;
                var startY = height/2;
                var endX = width;
                var endY = height/2;

                var movementx = (Math.sin(new Date() / 2500) * 400);
                var movementy = (Math.cos(new Date() / 2500) * 400);

                var startX = 0;
                var startY = height / 2;
                var endX = width;
                var endY = height / 2;

                var rangeX = endX - startX;
                var rangeY = endY - startY;
                var splits = 150;
                var xSegmentSize = rangeX / splits;
                var ySegmentSize = rangeY / splits;
                rangeX += xSegmentSize;
                rangeY += ySegmentSize;

                sp.graphics.moveTo(startX + x, startY + y);
                for (var x=0, y=0; x<rangeX || y<rangeY; x+=xSegmentSize, y+=ySegmentSize) {
                    sp.graphics.lineTo(startX + x, startY + y + (Math.random() * 250) - (250/2));
                }
            }


            window.requestAnimFrame = (function(){
              return  window.requestAnimationFrame       ||
                      window.webkitRequestAnimationFrame ||
                      window.mozRequestAnimationFrame    ||
                      function( callback ){
                        window.setTimeout(callback, 1000 / 60);
                      };
            })();

        </script>
    </head>
    <body onload="Init()">
        <canvas id="canvas"></canvas><br><br>
        <input type="file" name="file" id="fileUploadForm"><br>
    </body>
</html>
